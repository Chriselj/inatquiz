<!DOCTYPE html>
<html>
  <head>
    <title>Plant and Animal Knowledge Test</title>
    <style>
      /* General IRC-themed styling */
      body {
        font-family: 'Arial', sans-serif;
        background-color: #f8f9f3;
        color: #2e3b1f;
        margin: 0;
        padding: 0;
        text-align: center;
      }

      h1 {
        color: #5c7633;
      }

      i {
        color: #8b9b62;
      }

      label {
        font-weight: bold;
        margin-right: 10px;
      }

      input[type="text"],
      select {
        padding: 8px;
        margin: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      button {
        padding: 10px 20px;
        background-color: #5c7633;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background-color: #486328;
      }

      /* Loading bar styles */
      #loadingBar {
        width: 100%;
        background-color: #e0e5d9;
        border: 1px solid #c8d1b8;
        display: none;
      }

      #loadingBar div {
        height: 30px;
        width: 0;
        background-color: #8b9b62;
        text-align: center;
        line-height: 30px;
        color: white;
      }

      .image-container {
        display: inline-block;
        text-align: center;
        margin: 10px;
      }

      .image-container img {
        width: 300px;
        height: auto;
        cursor: pointer;
        border-radius: 10px;
        transition: transform 0.3s ease;
      }

      .image-container img:hover {
        transform: scale(1.05);
      }

      .attribution {
        text-align: center;
        margin-top: 20px;
      }

      .attribution img {
        width: 175px;
        height: auto;
      }

      /* Modal styling */
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .modal-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
      }

      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
      }

      .close:hover,
      .close:focus {
        color: #bbb;
        cursor: pointer;
      }

      .quiz-form {
        margin-top: 20px;
      }

      #speciesName {
        font-size: 20px;
        color: #5c7633;
        font-weight: bold;
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <h1>Plant and Animal Knowledge Test</h1>
    <i>Created by Irvine Ranch Conservancy's monitoring team for staff and volunteer training.</i>
    <br><br>

    <form id="configForm">
      <label for="category">Select a category:</label>
      <select id="category" name="category">
        <option value="">All Life</option>
        <optgroup label="Birds">
          <option value="3">All Birds</option>
          <option value="71261">Hawks, Eagles, Kites and Allies</option>
          <option value="7251">Perching Birds</option>
          <option value="559248">New World Sparrows</option>
          <option value="71349">New World Warblers</option>
        </optgroup>
        <optgroup label="Plants">
          <option value="47126">All Plants</option>
          <option value="47124">Dicots</option>
          <option value="47162">Grasses, Sedges, Cattails and Allies</option>
        </optgroup>
        <optgroup label="Butterflies">
          <option value="47224">All Butterflies</option>
          <option value="58558">Blues</option>
          <option value="47653">Skippers</option>
          <option value="48508">Whites, Yellows, and Sulphurs</option>
          <option value="47223">Swallowtails</option>
        </optgroup>
        <option value="40151">Mammals</option>
      </select>
      <br>
      <label for="taxonomy">Taxonomy ID (optional):</label>
      <input type="text" id="taxonomy" name="taxonomy" placeholder="Optional custom Taxonomy ID">
      <br>
      <label for="place">Place ID (default is Orange County, CA):</label>
      <select id="place" name="place">
        <optgroup label="Orange County, CA">
          <option value="2738">All Orange County</option>
          <option value="183147">Limestone Canyon Nature Preserve</option>
          <option value="5692">Crystal Cove State Park</option>
          <option value="186507">Laguna Coast Open Space</option>
          <option value="178642">Whiting Ranch Wilderness Park</option>
          <option value="4956">Weir Canyon</option>
          <option value="189397">Bommer Canyon</option>
          <option value="189398">Saddleback Wilderness</option>
        </optgroup>
      </select>
      <input type="text" id="customPlace" name="customPlace" placeholder="Optional custom Place ID">
      <br><br>
      <button type="submit">Fetch Observation</button>
    </form>

    <div id="loadingBar">
      <div id="loadingProgress">0%</div>
    </div>

    <div id="imagesContainer" style="display:none;">
      <div class="image-container">
        <img id="speciesImage1" src="" alt="Species Image 1" onclick="showModal(this)">
        <p id="credit1"></p>
      </div>
      <div class="image-container">
        <img id="speciesImage2" src="" alt="Species Image 2" onclick="showModal(this)">
        <p id="credit2"></p>
      </div>
      <div class="image-container">
        <img id="speciesImage3" src="" alt="Species Image 3" onclick="showModal(this)">
        <p id="credit3"></p>
      </div>
    </div>

    <form id="quizForm" class="quiz-form" style="display:none;">
      <button type="button" id="revealButton">Reveal Species Name</button>
    </form>

    <p id="speciesName" style="display:none;"></p>

    <div id="myModal" class="modal">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="img01">
      <div id="caption"></div>
    </div>

    <script>
      async function getAIExplanation(prompt) {
        try {
          const response = await fetch('https://your-site-name.netlify.app/.netlify/functions/openai-quiz', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ prompt: prompt })
          });
          const data = await response.json();
          return data.message;
        } catch (error) {
          console.error('Error fetching AI response:', error);
          return 'Sorry, there was an issue fetching the explanation.';
        }
      }

      document.getElementById('revealButton').onclick = async function () {
        const correctSpecies = document.getElementById('quizForm').dataset.correctSpecies;
        const commonName = document.getElementById('quizForm').dataset.commonName;
        
        document.getElementById('speciesName').innerText = 'Fetching explanation...';
        document.getElementById('speciesName').style.display = 'block';

        const prompt = `Provide an explanation for the species ${correctSpecies}, known as ${commonName}.`;
        const explanation = await getAIExplanation(prompt);
        
        document.getElementById('speciesName').innerText = `Common Name: ${commonName}\nScientific Name: ${correctSpecies}\nExplanation: ${explanation}`;
      };
    </script>
  </body>
</html>
